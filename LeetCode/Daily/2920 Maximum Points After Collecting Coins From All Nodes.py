'''
###### * User Profile : Keval_78 
LinkedIn: https://www.linkedin.com/in/kevalpadsala78/
Github: https://github.com/Keval78
Leetcode: https://leetcode.com/Keval_78/
'''
from typing import List
from collections import defaultdict


class Solution:
    def maximumPoints(self, edges: List[List[int]], coins: List[int], k: int) -> int:
        edge_map = defaultdict(list)
        for u, v in edges:
            edge_map[u].append(v)
            edge_map[v].append(u)

        n = len(coins)

        # DP with memoization
        def topdowndp(idx, power, parent, memo):
            if power > 14:
                return 0
            if memo[idx][power] != -1:
                return memo[idx][power]

            val = coins[idx]
            for _ in range(power):
                val //= 2

            way1 = val-k
            way2 = val//2
            for adj in edge_map[idx]:
                if adj == parent:
                    continue
                way1 += topdowndp(adj, power, idx, memo)
                way2 += topdowndp(adj, power+1, idx, memo)

            res = max(way1, way2)
            memo[idx][power] = res
            return res

        memo = [[-1]*15 for i in range(n)]
        return topdowndp(0, 0, -1, memo)


edges = [[0, 1], [1, 2], [2, 3]]
coins = [10, 10, 3, 3]
k = 5
ans = Solution().maximumPoints(edges, coins, k)
print(ans)

edges = [[0, 1], [0, 2]]
coins = [8, 4, 4]
k = 0
ans = Solution().maximumPoints(edges, coins, k)
print(ans)


edges = [[0,1],[2,1],[0,3],[4,2],[3,5],[1,6],[7,5],[8,2],[9,7],[9,10],[8,11],[6,12],[13,7],[7,14],[9,15],[16,13],[1,17],[18,12],[13,19],[20,3],[21,10],[22,7],[1,23],[24,4],[10,25],[26,12],[27,11],[28,3],[20,29],[4,30],[31,3],[32,11],[33,0],[34,28],[21,35],[36,13],[10,37],[29,38],[8,39],[27,40],[41,21],[42,32],[43,7],[44,26],[29,45],[32,46],[37,47],[25,48],[49,1],[38,50],[51,49],[49,52],[53,36],[5,54],[16,55],[56,41],[57,52],[58,24],[24,59],[60,16],[16,61],[54,62],[22,63],[40,64],[65,5],[8,66],[67,56],[68,31],[28,69],[19,70],[71,48],[43,72],[73,67],[74,56],[20,75],[76,5],[29,77],[3,78],[60,79],[51,80],[50,81],[82,36],[30,83],[7,84],[31,85],[86,4],[87,0],[4,88],[89,87],[47,90],[7,91],[79,92],[1,93],[73,94],[0,95],[56,96],[89,97],[98,89],[99,0],[100,5],[101,81],[89,102],[20,103],[104,13],[105,85],[52,106],[107,8],[67,108],[109,33],[110,75],[111,96],[75,112],[113,32],[77,114],[115,89],[58,116],[91,117],[37,118],[71,119],[120,103],[13,121],[122,78],[62,123],[124,55],[108,125],[118,126],[127,91],[87,128],[102,129],[130,104],[75,131],[132,108],[38,133],[99,134],[135,47],[136,82],[25,137],[138,60],[87,139],[140,20],[117,141],[83,142],[107,143],[38,144],[120,145],[103,146],[147,46],[148,105],[75,149],[31,150],[128,151],[152,148],[38,153],[75,154],[79,155],[86,156],[157,90],[125,158],[21,159],[157,160],[161,27],[125,162],[46,163],[164,150],[113,165],[166,74],[104,167],[105,168],[126,169],[108,170],[171,78],[172,133],[173,92],[174,116],[175,65],[176,154],[177,142],[178,23],[150,179],[145,180],[181,122],[13,182],[128,183],[184,48],[185,173],[186,156],[8,187],[55,188],[189,0],[190,77],[166,191],[192,108],[8,193],[137,194],[46,195],[76,196],[197,148],[168,198],[186,199],[200,107],[201,135],[170,202],[120,203],[204,121],[107,205],[206,10],[102,207],[208,60],[50,209],[64,210],[113,211],[212,77],[213,152],[214,16],[182,215],[216,159],[131,217],[218,173],[219,154],[128,220],[221,131],[6,222],[211,223],[224,197],[83,225],[226,71],[211,227],[228,48],[229,203],[3,230],[231,148],[232,30],[22,233],[220,234],[69,235],[0,236],[237,47],[207,238],[239,228],[240,129],[241,205],[204,242],[106,243],[244,45],[245,241],[246,44],[247,119],[144,248],[249,155],[231,250],[82,251],[252,225],[253,68],[45,254],[22,255],[81,256],[205,257],[258,133],[259,116],[260,61],[261,128],[262,102],[263,210],[185,264],[243,265],[266,193],[127,267],[132,268],[110,269],[270,107],[271,193],[272,90],[273,116],[274,265],[217,275],[186,276],[138,277],[178,278],[279,180],[195,280],[281,246],[22,282],[11,283],[18,284],[180,285],[286,199],[287,42],[169,288],[289,16],[290,252],[191,291],[292,15],[80,293],[294,133],[295,28],[296,105],[297,158],[298,182],[299,199],[68,300],[275,301],[302,150],[150,303],[304,159],[305,277],[156,306],[64,307],[308,298],[309,245],[278,310],[311,173],[312,120],[313,233],[118,314],[47,315],[152,316],[317,127],[318,310],[58,319],[149,320],[321,56],[322,203],[0,323],[324,280],[325,261],[209,326],[327,190],[62,328],[291,329],[66,330],[169,331],[332,8],[333,278],[129,334],[18,335],[336,253],[337,300],[338,7],[339,170],[340,88],[341,133],[342,2],[343,319],[344,283],[225,345],[322,346],[175,347],[34,348],[207,349],[341,350],[12,351],[101,352],[353,168],[354,260],[355,58],[356,36],[64,357],[358,259],[291,359],[276,360],[12,361],[310,362],[363,310],[235,364],[311,365],[366,153],[329,367],[6,368],[369,91],[370,54],[196,371],[171,372],[373,220],[197,374],[298,375],[235,376],[199,377],[378,328],[379,324],[150,380],[192,381],[382,201],[383,64],[384,272],[48,385],[0,386],[270,387],[388,54],[142,389],[390,24],[284,391],[392,7],[14,393],[394,209],[215,395],[396,38],[397,238],[398,313],[122,399],[370,400],[22,401],[247,402],[403,5],[404,273],[66,405],[5,406],[407,66],[408,343],[409,40],[410,36],[411,285],[317,412],[115,413],[414,145],[415,36],[43,416],[239,417],[418,125],[27,419],[420,191],[421,292],[422,202],[423,16],[424,62],[125,425],[426,141],[427,221],[428,133],[429,1],[117,430],[188,431],[432,431],[433,205],[434,248],[435,154],[436,434],[367,437],[113,438],[439,229],[348,440],[441,303],[368,442],[443,118],[444,16],[165,445],[446,121],[195,447],[448,225],[449,409],[450,353],[451,217],[452,440],[176,453],[357,454],[136,455],[405,456],[457,153],[458,78],[37,459],[460,223],[461,243],[305,462],[463,203],[401,464],[394,465],[427,466],[467,265],[388,468],[469,215],[470,352],[471,64],[472,132],[473,117],[4,474],[475,473],[434,476],[473,477],[478,361],[479,435],[480,245],[481,180],[482,98],[65,483],[109,484],[129,485],[334,486],[269,487],[163,488],[292,489],[126,490],[55,491],[163,492],[55,493],[494,121],[495,322],[496,344],[107,497],[498,186],[499,303],[500,38],[344,501],[501,502],[406,503],[504,214],[435,505],[289,506],[504,507],[508,0],[3,509],[254,510],[511,459],[305,512],[324,513],[165,514],[100,515],[516,462],[482,517],[193,518],[265,519],[382,520],[36,521],[522,121],[523,98],[524,7],[525,17],[76,526],[527,279],[528,111],[529,64],[530,93],[447,531],[532,525],[533,313],[188,534],[123,535],[27,536],[368,537],[408,538],[539,450],[445,540],[382,541],[542,403],[46,543],[132,544],[130,545],[88,546],[547,219],[172,548],[549,520],[362,550],[551,535],[552,50],[130,553],[265,554],[555,19],[270,556],[557,305],[558,300],[44,559],[229,560],[561,175],[562,88],[227,563],[564,276],[565,70],[566,416],[567,58],[568,341],[428,569],[342,570],[123,571],[51,572],[125,573],[148,574],[575,112],[576,371],[577,357],[578,362],[579,100],[2,580],[410,581],[77,582],[397,583],[208,584],[115,585],[586,511],[587,285],[588,436],[589,368],[319,590],[435,591],[592,266],[575,593],[594,242],[595,579],[443,596],[597,246],[598,532],[599,276],[230,600],[489,601],[602,253],[419,603],[523,604],[290,605],[606,50],[402,607],[214,608],[609,322],[610,337],[85,611],[612,201],[173,613],[614,87],[428,615],[255,616],[555,617],[391,618],[619,65],[491,620],[621,463],[622,97],[623,116],[624,114],[457,625],[312,626],[363,627],[14,628],[629,354],[630,335],[631,273],[632,432],[585,633],[634,540],[635,229],[636,40],[637,493],[638,431],[639,275],[640,18],[641,153],[44,642],[299,643],[644,198],[645,108],[646,405],[157,647],[648,456],[649,30],[195,650],[651,483],[352,652],[653,471],[540,654],[606,655],[138,656],[657,282],[222,658],[659,426],[660,231],[661,251],[662,149],[532,663],[394,664],[452,665],[82,666],[667,165],[668,343],[669,279],[670,133],[671,602],[579,672],[54,673],[674,447],[675,413],[98,676],[677,400],[406,678],[679,68],[97,680],[681,226],[682,433],[683,376],[440,684],[685,262],[469,686],[687,472],[450,688],[689,369],[624,690],[511,691],[242,692],[192,693],[241,694],[537,695],[693,696],[681,697],[698,241],[699,355],[700,23],[701,461],[702,76],[82,703],[704,636],[621,705],[366,706],[458,707],[238,708],[709,374],[36,710],[711,166],[248,712],[253,713],[151,714],[699,715],[716,77],[666,717],[508,718],[375,719],[275,720],[370,721],[488,722],[287,723],[643,724],[121,725],[726,452],[697,727],[522,728],[587,729],[666,730],[323,731],[694,732],[733,370],[734,82],[712,735],[736,49],[737,200],[599,738],[93,739],[740,483],[658,741],[714,742],[353,743],[22,744],[293,745],[746,241],[747,245],[748,642],[325,749],[750,125],[751,638],[33,752],[258,753],[443,754],[755,190],[756,515],[291,757],[203,758],[759,198]]
coins = [246,904,3,750,222,992,732,144,100,827,264,455,805,321,139,387,576,847,813,654,403,761,954,507,812,571,487,993,95,128,689,479,337,28,674,600,973,328,915,546,463,872,397,278,402,72,495,634,658,205,505,914,166,910,836,242,66,284,388,225,605,433,346,109,650,50,388,38,77,513,738,829,20,811,875,985,319,409,86,261,139,102,73,146,912,910,287,385,67,223,788,262,967,814,279,625,217,137,783,309,767,978,276,453,994,749,725,862,625,682,516,995,769,920,298,172,705,964,739,864,242,802,99,247,177,978,983,509,880,857,303,742,149,63,814,990,386,590,913,463,236,935,230,495,807,483,795,914,193,513,559,286,403,629,85,60,837,951,844,684,821,856,362,477,314,88,898,282,587,894,978,294,741,367,425,441,872,425,844,647,534,690,743,405,789,343,397,990,150,547,859,321,762,888,400,114,292,114,637,277,581,804,834,82,13,764,745,59,739,943,93,394,203,50,492,755,186,556,338,887,818,33,793,811,885,451,276,683,656,410,41,673,535,497,737,951,67,428,665,23,11,530,53,500,511,421,151,899,502,506,764,414,139,962,758,692,285,996,313,961,410,673,39,402,678,177,275,224,192,942,869,76,752,917,492,284,988,599,990,176,468,73,304,201,107,323,546,175,261,73,971,94,651,142,816,147,257,941,381,433,717,362,328,387,645,296,148,673,292,693,35,847,258,718,293,947,695,808,686,434,539,413,324,809,916,664,916,590,583,223,67,483,388,959,42,232,246,899,953,887,196,357,552,635,524,991,141,667,476,811,141,929,939,201,877,424,133,887,319,676,575,443,920,283,115,291,743,91,841,849,329,900,664,298,353,365,477,38,818,901,714,284,196,631,800,657,11,335,7,896,662,601,58,75,188,938,237,833,477,255,897,277,283,456,499,664,490,376,555,105,769,67,798,25,757,981,91,119,442,115,698,186,601,467,981,591,502,80,190,831,926,428,968,399,756,758,755,974,415,816,558,8,957,693,176,941,85,150,658,872,99,111,342,562,681,167,444,22,911,130,581,778,195,888,898,127,559,642,700,763,216,665,199,156,797,261,195,80,524,739,159,290,486,692,231,646,688,628,941,807,590,970,835,586,132,49,199,664,841,357,318,273,776,603,545,897,783,877,968,698,386,47,938,598,184,835,800,109,419,70,382,840,576,189,2,677,111,923,897,544,696,584,149,293,620,639,705,333,588,761,36,998,68,753,502,114,240,317,60,68,983,557,645,833,502,255,25,371,800,597,446,425,686,858,266,812,738,427,660,439,246,236,37,539,562,939,395,15,441,255,762,296,36,15,507,191,51,490,573,542,22,564,968,444,552,963,280,494,26,193,816,330,532,326,381,377,334,138,185,426,866,726,665,79,454,660,244,149,118,655,814,175,53,285,514,662,275,876,79,974,360,989,51,872,426,618,745,889,92,274,660,838,636,291,510,273,786,780,14,420,403,99,869,982,239,402,334,736,368,244,370,766,219,940,923,942,678,679,550,515,398,120,267,931,123,712,851,414,96,570,796,501,490,63,666,735,67,38,228,621,461,498,970,243,823,579,576,896,447,79,358,711,608,670,355,802,804,143,784,682,200,264,954,803,297,660,309,891,431,237,754,938,476,380,561,721,529,102,290,585,598,31,88,537,349,410,814,415,237,424,634,626,621,665,598,115,987,350,192,332,693,149,590,246,238,679,890,327,733,260]
k = 525
ans = Solution().maximumPoints(edges, coins, k)
print(ans)